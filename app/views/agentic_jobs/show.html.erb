
<div class="flex-1 flex flex-col overflow-hidden">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 shadow-sm flex-shrink-0">
    <div class="flex items-center space-x-4">
        <%= link_to root_path, class: "p-2 rounded-full hover:bg-gray-100 text-gray-500" do %>
          <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <% end %>
        <h1 class="text-xl font-bold text-gray-800" id="page-title">
            ジョブ詳細: <%= @agentic_job.id %>
        </h1>
    </div>
  </header>

    <!-- Content Body -->
    <main class="flex-1 overflow-y-auto p-6" id="main-scroll">
        <div class="max-w-4xl mx-auto space-y-6">
            
            <!-- Status Card -->
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500 font-medium mb-1">ステータス</p>
                    <div class="flex items-center">
                        <%= status_badge(@agentic_job.status) %>
                        <% if @agentic_job.action_required %>
                            <span class="ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i data-lucide="alert-circle" class="w-3 h-3 mr-1"></i>要対応
                            </span>
                        <% end %>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500 font-medium mb-1">実行日時</p>
                    <p class="text-lg font-mono text-gray-800"><%= @agentic_job.executed_at.strftime('%Y/%m/%d %H:%M:%S') %></p>
                </div>
            </div>

            <!-- Basic Info -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="text-md font-semibold text-gray-800">基本情報</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">取込元システム</label>
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <i data-lucide="server" class="w-4 h-4 text-gray-400 mr-2"></i>
                            <span class="text-gray-900 font-medium"><%= @agentic_job.source_system %></span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">取込先システム</label>
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <i data-lucide="database" class="w-4 h-4 text-gray-400 mr-2"></i>
                            <span class="text-gray-900 font-medium"><%= @agentic_job.destination_system %></span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">取込件数</label>
                        <p class="text-2xl font-bold text-gray-900"><%= @agentic_job.record_count.to_s.reverse.gsub(/(\d{3})(?=\d)/, '\1,').reverse %> 件</p>
                    </div>
                </div>
            </div>

            <!-- Error Details -->
            <% if @agentic_job.error_message.present? %>
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                     <div class="px-6 py-4 border-b border-gray-100 bg-red-50 flex items-center justify-between">
                        <h3 class="text-md font-semibold text-red-800 flex items-center">
                            <i data-lucide="alert-triangle" class="w-4 h-4 mr-2"></i>
                            エラー・警告詳細
                        </h3>
                    </div>
                    <div class="p-6 bg-red-50/10">
                        <div class="p-4 bg-gray-900 rounded-lg overflow-x-auto">
                            <pre class="text-red-400 font-mono text-sm whitespace-pre-wrap break-all"><%= @agentic_job.error_message %></pre>
                        </div>
                    </div>
                </div>
            <% end %>

            <!-- Contract Entries -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="text-md font-semibold text-gray-800">取得データ</h3>
                    <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full"><%= @contract_entries.size %> 件</span>
                </div>
                <% if @contract_entries.any? %>
                    <div class="p-6 space-y-4">
                        <% @contract_entries.each do |entry| %>
                            <div class="bg-white border border-gray-200 rounded-lg p-5 hover:shadow-md transition-shadow">
                                <!-- Header Row -->
                                <div class="flex items-start justify-between mb-4 pb-3 border-b border-gray-100">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <h4 class="text-lg font-semibold text-gray-900"><%= entry.property_name %></h4>
                                            <% if entry.applicant_type == '法人' %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                    法人
                                                </span>
                                            <% elsif entry.applicant_type == '個人' %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    個人
                                                </span>
                                            <% end %>
                                        </div>
                                        <p class="text-sm text-gray-500">
                                            <i data-lucide="map-pin" class="w-3 h-3 inline mr-1"></i>
                                            <%= entry.address || 'N/A' %>
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-blue-600"><%= entry.formatted_rent %></div>
                                        <% if entry.management_fee %>
                                            <div class="text-xs text-gray-500 mt-1">管理費: <%= entry.formatted_management_fee %></div>
                                        <% end %>
                                    </div>
                                </div>

                                <!-- Details Grid -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                    <div>
                                        <div class="text-xs text-gray-500 uppercase tracking-wider mb-1">申込者</div>
                                        <div class="text-sm font-medium text-gray-900"><%= entry.applicant_name || 'N/A' %></div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500 uppercase tracking-wider mb-1">申込日時</div>
                                        <div class="text-sm font-medium text-gray-900">
                                            <%= entry.application_date ? entry.application_date.strftime('%Y/%m/%d %H:%M') : 'N/A' %>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500 uppercase tracking-wider mb-1">番手</div>
                                        <div class="text-sm font-medium text-gray-900"><%= entry.priority || '-' %></div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500 uppercase tracking-wider mb-1">ステータス</div>
                                        <div class="text-sm font-medium text-gray-900"><%= entry.entry_status || 'N/A' %></div>
                                    </div>
                                </div>

                                <!-- Additional Info -->
                                <% if entry.broker_company_name || entry.broker_staff_name %>
                                    <div class="flex items-center justify-between pt-3 border-t border-gray-100">
                                        <div class="flex items-center gap-4 text-sm text-gray-600">
                                            <% if entry.broker_company_name %>
                                                <span>
                                                    <i data-lucide="building-2" class="w-3 h-3 inline mr-1"></i>
                                                    <%= entry.broker_company_name %>
                                                </span>
                                            <% end %>
                                            <% if entry.broker_staff_name %>
                                                <span>
                                                    <i data-lucide="user" class="w-3 h-3 inline mr-1"></i>
                                                    <%= entry.broker_staff_name %>
                                                </span>
                                            <% end %>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <span class="text-xs text-gray-400">ID: <%= entry.entry_head_id %></span>
                                            <% if entry.detail_url %>
                                                <a href="<%= entry.detail_url %>" target="_blank" class="inline-flex items-center px-3 py-1 bg-blue-50 text-blue-600 rounded-md text-sm font-medium hover:bg-blue-100 transition-colors">
                                                    <i data-lucide="external-link" class="w-3 h-3 mr-1"></i>
                                                    詳細を見る
                                                </a>
                                            <% end %>
                                        </div>
                                    </div>
                                <% end %>
                            </div>
                        <% end %>
                    </div>
                <% else %>
                    <div class="p-6 text-center text-gray-500 text-sm">
                        <p>取得されたデータがありません。</p>
                    </div>
                <% end %>
            </div>

             <!-- Logs (Placeholder) -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden opacity-60">
                 <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="text-md font-semibold text-gray-800">実行ログ</h3>
                </div>
                <div class="p-6 text-center text-gray-500 text-sm">
                    <p>ログの詳細は現在利用できません。</p>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Icons -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
</script>
