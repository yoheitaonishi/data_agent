
<div class="flex-1 flex flex-col overflow-hidden">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 shadow-sm flex-shrink-0">
    <div class="flex items-center space-x-4">
        <%= link_to root_path, class: "p-2 rounded-full hover:bg-gray-100 text-gray-500" do %>
          <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <% end %>
        <h1 class="text-xl font-bold text-gray-800" id="page-title">
            ジョブ詳細: <%= @agentic_job.id %>
        </h1>
    </div>
  </header>

    <!-- Content Body -->
    <main class="flex-1 overflow-y-auto p-6" id="main-scroll">
        <div class="max-w-4xl mx-auto space-y-6">
            
            <!-- Status Card -->
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500 font-medium mb-1">ステータス</p>
                    <div class="flex items-center">
                        <%= status_badge(@agentic_job.status) %>
                        <% if @agentic_job.action_required %>
                            <span class="ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i data-lucide="alert-circle" class="w-3 h-3 mr-1"></i>要対応
                            </span>
                        <% end %>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500 font-medium mb-1">実行日時</p>
                    <p class="text-lg font-mono text-gray-800"><%= @agentic_job.executed_at.strftime('%Y/%m/%d %H:%M:%S') %></p>
                </div>
            </div>

            <!-- Basic Info -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="text-md font-semibold text-gray-800">基本情報</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">取込元システム</label>
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <i data-lucide="server" class="w-4 h-4 text-gray-400 mr-2"></i>
                            <span class="text-gray-900 font-medium"><%= @agentic_job.source_system %></span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">取込先システム</label>
                        <div class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <i data-lucide="database" class="w-4 h-4 text-gray-400 mr-2"></i>
                            <span class="text-gray-900 font-medium"><%= @agentic_job.destination_system %></span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">取込件数</label>
                        <p class="text-2xl font-bold text-gray-900"><%= @agentic_job.record_count.to_s.reverse.gsub(/(\d{3})(?=\d)/, '\1,').reverse %> 件</p>
                    </div>
                </div>
            </div>

            <!-- Error Details -->
            <% if @agentic_job.error_message.present? %>
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                     <div class="px-6 py-4 border-b border-gray-100 bg-red-50 flex items-center justify-between">
                        <h3 class="text-md font-semibold text-red-800 flex items-center">
                            <i data-lucide="alert-triangle" class="w-4 h-4 mr-2"></i>
                            エラー・警告詳細
                        </h3>
                    </div>
                    <div class="p-6 bg-red-50/10">
                        <div class="p-4 bg-gray-900 rounded-lg overflow-x-auto">
                            <pre class="text-red-400 font-mono text-sm whitespace-pre-wrap break-all"><%= @agentic_job.error_message %></pre>
                        </div>
                    </div>
                </div>
            <% end %>

            <!-- Contract Entries -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                    <h3 class="text-md font-semibold text-gray-800">取得データ</h3>
                    <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full"><%= @contract_entries.size %> 件</span>
                </div>
                <% if @contract_entries.any? %>
                    <div class="p-6 space-y-4">
                        <% @contract_entries.each do |entry| %>
                            <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                <!-- Header Row -->
                                <div class="flex items-start justify-between mb-5 pb-4 border-b-2 border-gray-200">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <h4 class="text-xl font-bold text-gray-900"><%= entry.property_name %></h4>
                                            <% if entry.applicant_type == '法人' %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                                    法人
                                                </span>
                                            <% elsif entry.applicant_type == '個人' %>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    個人
                                                </span>
                                            <% end %>
                                            <span class="text-xs text-gray-400 ml-2">ID: <%= entry.entry_head_id %></span>
                                        </div>
                                        <p class="text-sm text-gray-500">
                                            <i data-lucide="map-pin" class="w-3 h-3 inline mr-1"></i>
                                            <%= entry.address || 'N/A' %>
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <% if entry.detail_url %>
                                            <a href="<%= entry.detail_url %>" target="_blank" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors mb-2">
                                                <i data-lucide="external-link" class="w-4 h-4 mr-1"></i>
                                                詳細を見る
                                            </a>
                                        <% end %>
                                    </div>
                                </div>

                                <!-- Property Information -->
                                <div class="mb-5">
                                    <h5 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3 flex items-center">
                                        <i data-lucide="home" class="w-4 h-4 mr-2"></i>
                                        物件情報
                                    </h5>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">部屋ID</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.room_id || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">面積</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.area ? "#{entry.area} ㎡" : '-' %></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Financial Information -->
                                <div class="mb-5">
                                    <h5 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3 flex items-center">
                                        <i data-lucide="banknote" class="w-4 h-4 mr-2"></i>
                                        費用情報
                                    </h5>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">家賃</div>
                                            <div class="text-lg font-bold text-blue-600"><%= entry.formatted_rent %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">管理費</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.formatted_management_fee %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">敷金</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.deposit ? "#{entry.deposit.to_i.to_s.reverse.gsub(/(\d{3})(?=\d)/, '\\1,').reverse} 円" : '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">礼金</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.key_money ? "#{entry.key_money.to_i.to_s.reverse.gsub(/(\d{3})(?=\d)/, '\\1,').reverse} 円" : '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">保証金</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.guarantee_deposit ? "#{entry.guarantee_deposit.to_i.to_s.reverse.gsub(/(\d{3})(?=\d)/, '\\1,').reverse} 円" : '-' %></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Applicant Information -->
                                <div class="mb-5">
                                    <h5 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3 flex items-center">
                                        <i data-lucide="user-circle" class="w-4 h-4 mr-2"></i>
                                        申込者情報
                                    </h5>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">申込者名</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.applicant_name || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">メールアドレス</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.applicant_email || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">申込日時</div>
                                            <div class="text-sm font-medium text-gray-900">
                                                <%= entry.application_date ? entry.application_date.strftime('%Y/%m/%d %H:%M') : '-' %>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">申込方法</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.application_method || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">番手</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.priority || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">ステータス</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.entry_status || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">編集権限</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.applicant_edit_permission || '-' %></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Broker Information -->
                                <div class="mb-5">
                                    <h5 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3 flex items-center">
                                        <i data-lucide="building-2" class="w-4 h-4 mr-2"></i>
                                        仲介会社情報
                                    </h5>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">会社名</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.broker_company_name || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">会社電話番号</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.broker_phone || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">担当者名</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.broker_staff_name || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">担当者電話番号</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.broker_staff_phone || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">担当者メール</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.broker_staff_email || '-' %></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Contract & Guarantee Information -->
                                <div class="mb-5">
                                    <h5 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-3 flex items-center">
                                        <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>
                                        契約・保証情報
                                    </h5>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">契約方法</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.contract_method || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">保証会社</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.guarantee_company || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">保証結果</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.guarantee_result || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">連帯保証人利用</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.joint_guarantor_usage || '-' %></div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-gray-500 mb-1">登録番号</div>
                                            <div class="text-sm font-medium text-gray-900"><%= entry.registration_number || '-' %></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Timestamps -->
                                <div class="pt-4 border-t border-gray-100 text-xs text-gray-400">
                                    <div class="flex justify-between">
                                        <span>取得日時: <%= entry.created_at.strftime('%Y/%m/%d %H:%M:%S') %></span>
                                        <span>更新日時: <%= entry.updated_at.strftime('%Y/%m/%d %H:%M:%S') %></span>
                                    </div>
                                </div>
                            </div>
                        <% end %>
                    </div>
                <% else %>
                    <div class="p-6 text-center text-gray-500 text-sm">
                        <p>取得されたデータがありません。</p>
                    </div>
                <% end %>
            </div>

             <!-- Logs (Placeholder) -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden opacity-60">
                 <div class="px-6 py-4 border-b border-gray-100 bg-gray-50">
                    <h3 class="text-md font-semibold text-gray-800">実行ログ</h3>
                </div>
                <div class="p-6 text-center text-gray-500 text-sm">
                    <p>ログの詳細は現在利用できません。</p>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Icons -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
</script>
